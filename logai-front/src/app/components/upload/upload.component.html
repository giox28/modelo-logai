<div class="card">
    <h1>GeoOptima</h1>
    <h2>Generación de Registros Sintéticos & Optimización</h2>

    <div class="info-box"
        style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:8px; margin-bottom:1.5rem; border-left: 4px solid var(--accent);">
        <h4 style="margin-top:0; color:var(--text-main);">Objetivos del Módulo</h4>
        <ul style="margin-bottom:0; padding-left:1.2rem; color:var(--text-muted); font-size:0.9rem;">
            <li><strong>Caso 1: Rescate de Datos (Data Rescue)</strong><br>Generar curvas faltantes en pozos antiguos
                usando correlaciones de la cuenca.</li>
            <li><strong>Caso 2: Optimización de Inversión (VOI)</strong><br>Análisis de sensibilidad para sugerir qué
                registros físicos son críticos para reducir la incertidumbre, justificando los Programas Exploratorios.
            </li>
        </ul>
    </div>

    <form (ngSubmit)="onSubmit()">
        <div class="form-group">
            <label>1. Seleccionar Cuenca</label>
            <select [(ngModel)]="selectedBasin" name="basin" (change)="onBasinChange()">
                <option *ngIf="basins.length === 0" value="" disabled>Cargando cuencas...</option>
                <option *ngFor="let basin of basins" [value]="basin">{{ basin | titlecase }}</option>
            </select>
        </div>

        <div class="form-group"
            style="background: rgba(255, 255, 255, 0.03); padding: 10px; border-radius: 4px; margin-top: 1rem;">
            <label style="color: var(--accent);">1b. Configuración de Proyecto (Opcional)</label>

            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <label style="font-size: 0.8rem; display:block; margin-bottom:0.3rem;">Tipo de Proyecto (Contexto
                        VOI)</label>
                    <select [(ngModel)]="projectType" name="projectType"
                        style="width:100%; padding:0.5rem; border-radius:4px; border:1px solid #444; background:#222; color:white;">
                        <option *ngFor="let type of projectTypes" [value]="type.value">
                            {{ type.label }}
                        </option>
                    </select>
                </div>

                <div style="flex: 1; min-width: 200px;">
                    <label style="font-size: 0.8rem; display:block; margin-bottom:0.3rem;">Modelo Análogo (Transfer
                        Learning)</label>
                    <select [(ngModel)]="analogModel" name="analogModel" (change)="onAnalogModelChange()"
                        style="width:100%; padding:0.5rem; border-radius:4px; border:1px solid #444; background:#222; color:white;">
                        <option value="">-- Ninguno (Usar Modelo Local) --</option>
                        <option *ngFor="let basin of basins" [value]="basin">Inteligencia {{ basin | titlecase }}
                        </option>
                    </select>
                    <small style="display:block; color:#888; font-size:0.75rem; margin-top:4px;">
                        Úselo para Cuencas Frontera donde no existen modelos propios.
                    </small>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>2. Cargar Archivo LAS</label>
            <div class="file-drop-area" [class.dragover]="isDragOver" (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" (click)="fileInput.click()">
                <span class="file-msg">Arrastra tu archivo aquí o haz clic para buscar</span>
                <input #fileInput type="file" class="file-input" accept=".las" (change)="onFileSelected($event)"
                    style="display:none">
            </div>
            <div *ngIf="fileName" style="margin-top:0.5rem; font-size:0.9rem; color:var(--secondary);">
                Archivo Seleccionado: {{ fileName }}
            </div>

            <!-- Input Curves Selection -->
            <div *ngIf="curvesInFile.length > 0" style="margin-top:1rem;">
                <label style="font-size:0.9rem; color:var(--text-muted); display:block; margin-bottom:0.5rem;">
                    Selecciona logs para visualizar:
                </label>
                <div class="checkbox-group">
                    <label *ngFor="let curve of inputCurvesList" class="checkbox-container">
                        <input type="checkbox" [checked]="inputCurveSelection[curve]"
                            (change)="inputCurveSelection[curve] = !inputCurveSelection[curve]; updateInputPlot()">
                        {{ curve }}
                    </label>
                </div>
            </div>

            <!-- Input Plot Container -->
            <div id="inputPlot" style="width:100%; margin-top:1rem;"></div>
        </div>

        <div class="form-group">
            <label>3. Curvas Objetivo a Reconstruir</label>
            <div class="checkbox-group" id="targetContainer">
                <p *ngIf="availableModels.length === 0" style="color:var(--text-muted); font-size:0.9rem;">
                    Selecciona un archivo y cuenca primero...
                </p>

                <label *ngFor="let model of availableModels" class="checkbox-container"
                    [style.opacity]="isCurveInFile(model) ? 0.7 : 1">
                    <input type="checkbox" [(ngModel)]="targetSelection[model]" [name]="'target-'+model">
                    {{ model }} <span *ngIf="isCurveInFile(model)" style="font-size:0.8em">(Existe)</span>
                </label>
            </div>
        </div>

        <button type="submit" class="btn-primary" [disabled]="!file || isLoading">
            <span *ngIf="isLoading" class="loader" style="display:inline-block"></span>
            <span *ngIf="!isLoading">Procesar Registro</span>
            <span *ngIf="isLoading">Procesando...</span>
        </button>
    </form>
</div>